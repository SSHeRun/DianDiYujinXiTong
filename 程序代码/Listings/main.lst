C51 COMPILER V9.57.0.0   MAIN                                                              04/10/2019 21:26:41 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          #include "delay.h"
   4          #include "lcd1602.h"
   5          #include "steper.h"
   6          #include "keypress.h"
   7          
   8          uchar dishu_sheding = 0;
   9          uchar dishu_shiji = 0;
  10          uchar diandi_number = 0;
  11          uchar Number = 0;
  12          uchar PuZh[34] = "";
  13          uchar level = 0;
  14          
  15          sbit buzzer = P2^0;
  16          /*******************************************************************************
  17          * å‡½ æ•° å       : Timer_Init()
  18          * å‡½æ•°åŠŸèƒ½       : è®¾ç½®å®šæ—¶
  19          * è¾“    å…¥       : æ— 
  20          * è¾“    å‡º       : æ— 
  21          *******************************************************************************/
  22          void Timer_Init()
  23          {
  24   1        TMOD = 0x11;//å®šæ—¶å™¨0å®šæ—¶å™¨1ä¸ºå·¥ä½œæ–¹å¼1
  25   1        /*  è£…è½½åˆå€¼  */
  26   1        TH0 = (65536-50000)/256;
  27   1        TL0 = (65536-50000)%256;
  28   1        
  29   1        EA = 1;//å¼€æ€»ä¸­æ–­
  30   1        /*  å¼€å¯å®šæ—¶å™¨ä¸­æ–­  */
  31   1        ET0 = 1;//å®šæ—¶å™¨0
  32   1        /*  å¯åŠ¨å®šæ—¶å™¨  */
  33   1        TR0 = 1;//å®šæ—¶å™¨0
  34   1        /*  å¤–éƒ¨ä¸­æ–­  */
  35   1        EX0 = 1;
  36   1        EX1 = 1;
  37   1        IT0 = 1;
  38   1        IT1 = 1;
  39   1      }
  40          
  41          /*******************************************************************************
  42          * å‡½ æ•° å       : UsartConfiguration()
  43          * å‡½æ•°åŠŸèƒ½       : è®¾ç½®ä¸²å£
  44          * è¾“    å…¥       : æ— 
  45          * è¾“    å‡º       : æ— 
  46          *******************************************************************************/
  47          
  48          void UsartConfiguration()
  49          { 
  50   1        SCON=0X50;      //è®¾ç½®ä¸ºå·¥ä½œæ–¹å¼1,8ä½æ•°æ®ï¼Œå¯å˜æ³¢ç‰¹ç‡
  51   1        TMOD=0X20;      //è®¾ç½®è®¡æ•°å™¨å·¥ä½œæ–¹å¼2
  52   1        PCON=0X00;      //æ³¢ç‰¹ç‡ä¸åŠ å€
  53   1        TH1=0XFd;       //è®¡æ•°å™¨åˆå§‹å€¼è®¾ç½®ï¼Œ9600@11.0592MHz
  54   1        TL1=0XFd;
C51 COMPILER V9.57.0.0   MAIN                                                              04/10/2019 21:26:41 PAGE 2   

  55   1        TR1=1;          //æ‰“å¼€è®¡æ•°å™¨
  56   1        ES = 1;         //å¼€ä¸²å£ä¸­æ–­
  57   1        EA = 1;         //å¼€æ€»ä¸­æ–­
  58   1      }
  59          
  60          
  61          /*------------------------------------------------
  62           ä¸­æ–­0å‡½æ•°ï¼Œæ£€æµ‹æ»´ç®¡é‡Œé¢ä¸‹è½ç‚¹æ»´çš„æ•°é‡
  63          ------------------------------------------------*/
  64          void Interrupt0() interrupt 0
  65          {
  66   1        diandi_number++;
  67   1      }
  68          /*------------------------------------------------
  69          å®šæ—¶è®¡æ•°0ï¼Œè®¾å®šä¸º10sï¼Œæ£€æµ‹ç‚¹æ»´é€Ÿåº¦ï¼Œæ—¶é—´è¶Šé•¿ï¼Œç²¾åº¦è¶Šé«˜
  70          ------------------------------------------------*/
  71          void T0_Time() interrupt 1 
  72          {
  73   1        /*  é‡è£…åˆå€¼  */
  74   1        TH0 = (65536-50000)/256;
  75   1        TL0 = (65536-50000)%256;
  76   1        Number++;
  77   1        if(Number==20*10)
  78   1        {
  79   2          Number = 0;
  80   2          dishu_shiji = diandi_number*6;
  81   2          if((dishu_shiji-dishu_sheding)>6)//è‡ªåŠ¨æ ¡æ­£æµé€Ÿç¨‹åº
  82   2          {
  83   3            level++;
  84   3            if(level<=13)
  85   3              {
  86   4                Move(1,10);
  87   4              }
  88   3          }
  89   2          else if((dishu_shiji-dishu_sheding)<-6)
  90   2          {
  91   3            level--;
  92   3            if(level>=0)
  93   3              {
  94   4                Move(1,10);
  95   4              }
  96   3            Move(0,10);
  97   3          }
  98   2          else;
  99   2          
 100   2          diandi_number = 0;
 101   2        }
 102   1      }
 103          /*------------------------------------------------
 104           ä¸­æ–­1å‡½æ•°ï¼Œæ£€æµ‹ç‚¹æ»´è¢‹æ˜¯å¦æœ‰æ¶²ä½“ï¼Œå½“å‘ç”Ÿä¸­æ–­ï¼Œèœ‚é¸£å™¨æŠ¥è­¦ï¼Œå¹¶ä¸”å…³é—­è¾“æ¶²ç®
             -¡
 105          ------------------------------------------------*/
 106          void Interrupt1() interrupt 2
 107          {
 108   1        uchar i=0;
 109   1        for(;i<13-level;i++)
 110   1        {
 111   2          Move(1,10);
 112   2        }
 113   1        dishu_sheding=0;
 114   1        buzzer = 0;
 115   1      }
C51 COMPILER V9.57.0.0   MAIN                                                              04/10/2019 21:26:41 PAGE 3   

 116          
 117          /********************************************************************
 118          * åç§° : Com_Int()
 119          * åŠŸèƒ½ : ä¸²å£ä¸­æ–­å­å‡½æ•°
 120          * è¾“å…¥ : æ—  * è¾“å‡º : æ— 
 121          ***********************************************************************/
 122          void Com_Int(void) interrupt 4
 123          {
 124   1        uchar i;
 125   1        uchar receive_data;
 126   1        
 127   1        EA = 0;
 128   1        
 129   1        if(RI == 1) //å½“ç¡¬ä»¶æ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®æ—¶ï¼ŒRIä¼šç½®ä½
 130   1        {     
 131   2          RI = 0;
 132   2          receive_data = SBUF;//æ¥æ”¶åˆ°çš„æ•°æ®
 133   2            
 134   2          if(receive_data == '1')  
 135   2          {
 136   3            PuZh[0]='0'+dishu_shiji/100;
 137   3            PuZh[1]='0'+dishu_shiji%100/10;
 138   3            PuZh[2]='0'+dishu_shiji%10;
 139   3            PuZh[3]='\0';
 140   3            for(i=0; i<4; i++)
 141   3            {
 142   4                SBUF = PuZh[i];   //å°†è¦å‘é€çš„æ•°æ®æ”¾å…¥åˆ°å‘é€å¯„å­˜å™¨
 143   4                while(!TI);       //ç­‰å¾…å‘é€æ•°æ®å®Œæˆ
 144   4                TI=0;             //æ¸…é™¤å‘é€å®Œæˆæ ‡å¿—ä½
 145   4                DelayMs(1);
 146   4                //LED =0;
 147   4            }
 148   3          }
 149   2          else if(receive_data == '2')
 150   2          {
 151   3              buzzer=!buzzer; 
 152   3          }else;
 153   2          
 154   2        }
 155   1          
 156   1        
 157   1          EA = 1;
 158   1      }
 159          
 160          
 161          void main()
 162          {
 163   1        
 164   1        uchar keyvalue;//é”®å€¼
 165   1        uchar k;//è®¾å®šæ»´æ•°æ˜¾ç¤ºçš„ä½ç½®
 166   1        uchar value[3]={0,0,0};//ä¿å­˜è¾“å…¥è®¾å®šæ»´æ•°çš„å€¼,é»˜è®¤ä¸º0
 167   1        uchar i;//ä¸´æ—¶å˜é‡
 168   1        
 169   1        buzzer=1;//åˆå§‹åŒ–èœ‚é¸£å™¨
 170   1        lcd1602_init();//åˆå§‹åŒ–lcd
 171   1        Timer_Init();//åˆå§‹åŒ–å®šæ—¶
 172   1        UsartConfiguration();//åˆå§‹åŒ–ä¸²å£
 173   1          
 174   1        
 175   1        while(1)
 176   1        {   
 177   2          lcd1602_clear();//æ¸…å±
C51 COMPILER V9.57.0.0   MAIN                                                              04/10/2019 21:26:41 PAGE 4   

 178   2          lcd1602_write_string(0,0,"now:");
 179   2          lcd1602_write_string(9,0,"d/min");
 180   2          lcd1602_write_string(0,1,"set:");
 181   2          lcd1602_write_string(9,1,"d/min");
 182   2          lcd1602_write_char(6,0,'0'+dishu_shiji/100);
 183   2          lcd1602_write_char(7,0,'0'+dishu_shiji%100/10);
 184   2          lcd1602_write_char(8,0,'0'+dishu_shiji%10);
 185   2            
 186   2            
 187   2          if (KeyPress())
 188   2              {//æŒ‰é”®å¤„ç†ç¨‹åº
 189   3                  keyvalue = KeyScan();
 190   3                
 191   3                  if (keyvalue ==14)
 192   3                  {//æ‰‹åŠ¨æ ¡å‡†æ­¥è¿›ç”µæœº
 193   4                    DelayMs(200);//å»æŠ–
 194   4                    while(1)
 195   4                    {
 196   5                      if(KeyPress())
 197   5                      {
 198   6                        keyvalue = KeyScan();
 199   6                        if(keyvalue == 11)//æ­£å‘è°ƒæ•´
 200   6                        {
 201   7                          Move(1,10);
 202   7                        }           
 203   6                        if(keyvalue == 12)//åå‘è°ƒæ•´
 204   6                        {
 205   7                          Move(0,10);
 206   7                        }
 207   6                        if(keyvalue ==16)//é€€å‡º
 208   6                        {
 209   7                          level = 0;
 210   7                          break;
 211   7                        }
 212   6                        while (KeyPress());
 213   6                      }
 214   5                    } 
 215   4                  }
 216   3                  
 217   3                  if(keyvalue ==15)
 218   3                  {//è®¾ç½®æ˜¾ç¤ºæ¨¡å¼
 219   4                    DelayMs(200);//å»æŠ–
 220   4                    while(1)
 221   4                    {
 222   5                      if(KeyPress())
 223   5                      {
 224   6                        keyvalue = KeyScan();
 225   6                        if(keyvalue ==11)//å‘å·¦æ»šåŠ¨
 226   6                        {
 227   7                            i=40;
 228   7                            while(i--)
 229   7                            {
 230   8                              DelayMs(200);
 231   8                              lcd1602_turn_right();
 232   8                            }   
 233   7                        }
 234   6                        if(keyvalue ==12)//å‘å³æ»šåŠ¨
 235   6                        {
 236   7                            i=40;
 237   7                            while(i--)
 238   7                            {
 239   8                              DelayMs(200);
C51 COMPILER V9.57.0.0   MAIN                                                              04/10/2019 21:26:41 PAGE 5   

 240   8                              lcd1602_turn_left();
 241   8                            }
 242   7                        }
 243   6                        if(keyvalue ==16)//æ¸…å±å¹¶é€€å‡º
 244   6                        {
 245   7                          lcd1602_clear();
 246   7                          break;
 247   7                        }
 248   6                        while (KeyPress());
 249   6                      }
 250   5                    }
 251   4                    
 252   4                  }
 253   3                          
 254   3                  
 255   3                  if(keyvalue==13)
 256   3                  {//è®¾å®šæ»´æ•°
 257   4                    DelayMs(200);//å»æŠ–
 258   4                    k=6;
 259   4                    while(1)
 260   4                    {
 261   5                      DelayMs(200);//å»æŠ–
 262   5                      if(KeyPress())
 263   5                      {
 264   6                        keyvalue = KeyScan();
 265   6                        if(keyvalue==0||keyvalue==1||keyvalue==2||keyvalue==3||keyvalue==4||keyvalue==5||keyvalue==6||key
             -value==7||keyvalue==8||keyvalue==9)
 266   6                        {
 267   7                          if(k==6)
 268   7                          {
 269   8                            value[0]=keyvalue;
 270   8                          }
 271   7                          else if(k==7)
 272   7                          {
 273   8                            value[1]=keyvalue;
 274   8                          }
 275   7                          else if(k==8)
 276   7                          {
 277   8                            value[2]=keyvalue;
 278   8                          }
 279   7                          keyvalue = '0'+ keyvalue;           
 280   7                          lcd1602_write_char(k,1,keyvalue);
 281   7                        }
 282   6                        else if(keyvalue == 11)
 283   6                        {
 284   7                          k=k-1;
 285   7                        }
 286   6                        else if(keyvalue == 12)
 287   6                        {
 288   7                          k=k+1;
 289   7                        }
 290   6                        else if (keyvalue==16)
 291   6                        {
 292   7                          dishu_sheding = value[0]*100+value[1]*10+value[2]; 
 293   7                          break;
 294   7                        }
 295   6                        else;
 296   6                        while (KeyPress());
 297   6                      }
 298   5                    }
 299   4                  }
 300   3                  while (KeyPress());
C51 COMPILER V9.57.0.0   MAIN                                                              04/10/2019 21:26:41 PAGE 6   

 301   3              }else{
 302   3                lcd1602_write_char(6,1,'0'+dishu_sheding/100);
 303   3                lcd1602_write_char(7,2,'0'+dishu_sheding%100/10);
 304   3                lcd1602_write_char(8,3,'0'+dishu_sheding%10);
 305   3              }
 306   2              
 307   2          DelayMs(200);
 308   2        }
 309   1      } 
 310          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1398    ----
   CONSTANT SIZE    =     19    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     41       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
