C51 COMPILER V9.57.0.0   MAIN                                                              04/08/2019 18:40:39 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          #include "delay.h"
   4          #include "lcd1602.h"
   5          #include "steper.h"
   6          #include "keypress.h"
   7          
   8          uchar dishu_sheding = 0;
   9          uchar dishu_shiji = 0;
  10          uchar diandi_number = 0;
  11          uchar Number = 0;
  12          uchar PuZh[34] = "";
  13          uchar level = 0;
  14          
  15          sbit buzzer = P2^3;
  16          
  17          /*******************************************************************************
  18          * å‡½ æ•° å       : Timer_Init()
  19          * å‡½æ•°åŠŸèƒ½       : è®¾ç½®å®šæ—¶
  20          * è¾“    å…¥       : æ— 
  21          * è¾“    å‡º       : æ— 
  22          *******************************************************************************/
  23          void Timer_Init()
  24          {
  25   1        TMOD = 0x11;//å®šæ—¶å™¨0å®šæ—¶å™¨1ä¸ºå·¥ä½œæ–¹å¼1
  26   1        /*  è£…è½½åˆå€¼  */
  27   1        TH0 = (65536-50000)/256;
  28   1        TL0 = (65536-50000)%256;
  29   1        
  30   1        EA = 1;//å¼€æ€»ä¸­æ–­
  31   1        /*  å¼€å¯å®šæ—¶å™¨ä¸­æ–­  */
  32   1        ET0 = 1;//å®šæ—¶å™¨0
  33   1        /*  å¯åŠ¨å®šæ—¶å™¨  */
  34   1        TR0 = 1;//å®šæ—¶å™¨0
  35   1        /*  å¤–éƒ¨ä¸­æ–­  */
  36   1        EX0 = 1;
  37   1        EX1 = 1;
  38   1        IT0 = 1;
  39   1        IT1 = 1;
  40   1      }
  41          
  42          /*******************************************************************************
  43          * å‡½ æ•° å       : UsartConfiguration()
  44          * å‡½æ•°åŠŸèƒ½       : è®¾ç½®ä¸²å£
  45          * è¾“    å…¥       : æ— 
  46          * è¾“    å‡º       : æ— 
  47          *******************************************************************************/
  48          
  49          void UsartConfiguration()
  50          { 
  51   1        SCON=0X50;      //è®¾ç½®ä¸ºå·¥ä½œæ–¹å¼1,8ä½æ•°æ®ï¼Œå¯å˜æ³¢ç‰¹ç‡
  52   1        TMOD=0X20;      //è®¾ç½®è®¡æ•°å™¨å·¥ä½œæ–¹å¼2
  53   1        PCON=0X00;      //æ³¢ç‰¹ç‡ä¸åŠ å€
  54   1        TH1=0XFd;       //è®¡æ•°å™¨åˆå§‹å€¼è®¾ç½®ï¼Œ9600@11.0592MHz
C51 COMPILER V9.57.0.0   MAIN                                                              04/08/2019 18:40:39 PAGE 2   

  55   1        TL1=0XFd;
  56   1        TR1=1;          //æ‰“å¼€è®¡æ•°å™¨
  57   1        ES = 1;         //å¼€ä¸²å£ä¸­æ–­
  58   1        EA = 1;         //å¼€æ€»ä¸­æ–­
  59   1      }
  60          
  61          
  62          /*------------------------------------------------
  63           ä¸­æ–­0å‡½æ•°ï¼Œæ£€æµ‹æ»´ç®¡é‡Œé¢ä¸‹è½ç‚¹æ»´çš„æ•°é‡
  64          ------------------------------------------------*/
  65          void Interrupt0() interrupt 0
  66          {
  67   1        diandi_number++;
  68   1      }
  69          /*------------------------------------------------
  70          å®šæ—¶è®¡æ•°0ï¼Œè®¾å®šä¸º10sï¼Œæ£€æµ‹ç‚¹æ»´é€Ÿåº¦ï¼Œæ—¶é—´è¶Šé•¿ï¼Œç²¾åº¦è¶Šé«˜
  71          ------------------------------------------------*/
  72          void T0_Time() interrupt 1 
  73          {
  74   1        /*  é‡è£…åˆå€¼  */
  75   1        TH0 = (65536-50000)/256;
  76   1        TL0 = (65536-50000)%256;
  77   1        Number++;
  78   1        if(Number==20*10)
  79   1        {
  80   2          Number = 0;
  81   2          dishu_shiji = diandi_number*6;
  82   2          if((dishu_shiji-dishu_sheding)>6)//è‡ªåŠ¨æ ¡æ­£æµé€Ÿç¨‹åº
  83   2          {
  84   3            level++;
  85   3            if(level<=13)
  86   3              {
  87   4                Move(1,10);
  88   4              }
  89   3          }
  90   2          else if((dishu_shiji-dishu_sheding)<-6)
  91   2          {
  92   3            level--;
  93   3            if(level>=0)
  94   3              {
  95   4                Move(1,10);
  96   4              }
  97   3            Move(0,10);
  98   3          }
  99   2          else;
 100   2          
 101   2          diandi_number = 0;
 102   2        }
 103   1      }
 104          /*------------------------------------------------
 105           ä¸­æ–­1å‡½æ•°ï¼Œæ£€æµ‹ç‚¹æ»´è¢‹æ˜¯å¦æœ‰æ¶²ä½“ï¼Œå½“å‘ç”Ÿä¸­æ–­ï¼Œèœ‚é¸£å™¨æŠ¥è­¦ï¼Œå¹¶ä¸”å…³é—­è¾“æ¶²ç®
             -¡
 106          ------------------------------------------------*/
 107          void Interrupt1() interrupt 2
 108          {
 109   1        uchar i=0;
 110   1        for(;i<13-level;i++)
 111   1        {
 112   2          Move(1,10);
 113   2        }
 114   1        dishu_sheding=0;
 115   1        buzzer = 0;
C51 COMPILER V9.57.0.0   MAIN                                                              04/08/2019 18:40:39 PAGE 3   

 116   1      }
 117          
 118          /********************************************************************
 119          * åç§° : Com_Int()
 120          * åŠŸèƒ½ : ä¸²å£ä¸­æ–­å­å‡½æ•°
 121          * è¾“å…¥ : æ—  * è¾“å‡º : æ— 
 122          ***********************************************************************/
 123          void Com_Int(void) interrupt 4
 124          {
 125   1        uchar i;
 126   1        uchar receive_data;
 127   1        
 128   1        EA = 0;
 129   1        
 130   1        if(RI == 1) //å½“ç¡¬ä»¶æ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®æ—¶ï¼ŒRIä¼šç½®ä½
 131   1        {     
 132   2          RI = 0;
 133   2          receive_data = SBUF;//æ¥æ”¶åˆ°çš„æ•°æ®
 134   2            
 135   2          if(receive_data == '1')  
 136   2          {
 137   3            PuZh[0]='0'+dishu_shiji/100;
 138   3            PuZh[1]='0'+dishu_shiji%100/10;
 139   3            PuZh[2]='0'+dishu_shiji%10;
 140   3            PuZh[3]='\0';
 141   3            for(i=0; i<4; i++)
 142   3          {
 143   4              SBUF = PuZh[i];   //å°†è¦å‘é€çš„æ•°æ®æ”¾å…¥åˆ°å‘é€å¯„å­˜å™¨
 144   4              while(!TI);       //ç­‰å¾…å‘é€æ•°æ®å®Œæˆ
 145   4              TI=0;             //æ¸…é™¤å‘é€å®Œæˆæ ‡å¿—ä½
 146   4              DelayMs(1);
 147   4              //LED =0;
 148   4          }
 149   3          }
 150   2          else
 151   2          {
 152   3              //LED =1; 
 153   3          }
 154   2          
 155   2        }
 156   1          
 157   1        
 158   1          EA = 1;
 159   1      }
 160          
 161          
 162          void main()
 163          {
 164   1        
 165   1        uchar keyvalue;//é”®å€¼
 166   1        uchar k;//è®¾å®šæ»´æ•°æ˜¾ç¤ºçš„ä½ç½®
 167   1        uchar value[3]={0,0,0};//ä¿å­˜è¾“å…¥è®¾å®šæ»´æ•°çš„å€¼,é»˜è®¤ä¸º0
 168   1        uchar i;//ä¸´æ—¶å˜é‡
 169   1        
 170   1        Timer_Init();//åˆå§‹åŒ–å®šæ—¶
 171   1        UsartConfiguration();//åˆå§‹åŒ–ä¸²å£
 172   1        lcd1602_init();
 173   1        
 174   1        while(1)
 175   1        {   
 176   2          lcd1602_clear();//æ¸…å±
 177   2          lcd1602_write_string(0,0,"now:");
C51 COMPILER V9.57.0.0   MAIN                                                              04/08/2019 18:40:39 PAGE 4   

 178   2          lcd1602_write_string(9,0,"d/min");
 179   2          lcd1602_write_string(0,1,"set:");
 180   2          lcd1602_write_string(9,1,"d/min");
 181   2          lcd1602_write_char(6,0,'0'+dishu_shiji/100);
 182   2          lcd1602_write_char(7,0,'0'+dishu_shiji%100/10);
 183   2          lcd1602_write_char(8,0,'0'+dishu_shiji%10);
 184   2              
 185   2            
 186   2          if (KeyPress())
 187   2              {//æŒ‰é”®å¤„ç†ç¨‹åº
 188   3                  keyvalue = KeyScan();
 189   3                
 190   3                  if (keyvalue ==14)
 191   3                  {//æ‰‹åŠ¨æ ¡å‡†æ­¥è¿›ç”µæœº
 192   4                    DelayMs(200);//å»æŠ–
 193   4                    while(1)
 194   4                    {
 195   5                      if(KeyPress())
 196   5                      {
 197   6                        keyvalue = KeyScan();
 198   6                        if(keyvalue == 11)//æ­£å‘è°ƒæ•´
 199   6                        {
 200   7                          Move(1,10);
 201   7                        }           
 202   6                        if(keyvalue == 12)//åå‘è°ƒæ•´
 203   6                        {
 204   7                          Move(0,10);
 205   7                        }
 206   6                        if(keyvalue ==16)//é€€å‡º
 207   6                        {
 208   7                          level = 0;
 209   7                          break;
 210   7                        }
 211   6                        while (KeyPress());
 212   6                      }
 213   5                    } 
 214   4                  }
 215   3                  
 216   3                  if(keyvalue ==15)
 217   3                  {//è®¾ç½®æ˜¾ç¤ºæ¨¡å¼
 218   4                    DelayMs(200);//å»æŠ–
 219   4                    while(1)
 220   4                    {
 221   5                      if(KeyPress())
 222   5                      {
 223   6                        keyvalue = KeyScan();
 224   6                        if(keyvalue ==11)//å‘å·¦æ»šåŠ¨
 225   6                        {
 226   7                            i=40;
 227   7                            while(i--)
 228   7                            {
 229   8                              DelayMs(200);
 230   8                              lcd1602_turn_right();
 231   8                            }   
 232   7                        }
 233   6                        if(keyvalue ==12)//å‘å³æ»šåŠ¨
 234   6                        {
 235   7                            i=40;
 236   7                            while(i--)
 237   7                            {
 238   8                              DelayMs(200);
 239   8                              lcd1602_turn_left();
C51 COMPILER V9.57.0.0   MAIN                                                              04/08/2019 18:40:39 PAGE 5   

 240   8                            }
 241   7                        }
 242   6                        if(keyvalue ==16)//æ¸…å±å¹¶é€€å‡º
 243   6                        {
 244   7                          lcd1602_clear();
 245   7                          break;
 246   7                        }
 247   6                        while (KeyPress());
 248   6                      }
 249   5                    }
 250   4                    
 251   4                  }
 252   3                          
 253   3                  
 254   3                  if(keyvalue==13)
 255   3                  {//è®¾å®šæ»´æ•°
 256   4                    DelayMs(200);//å»æŠ–
 257   4                    k=6;
 258   4                    while(1)
 259   4                    {
 260   5                      DelayMs(200);//å»æŠ–
 261   5                      if(KeyPress())
 262   5                      {
 263   6                        keyvalue = KeyScan();
 264   6                        if(keyvalue==0||keyvalue==1||keyvalue==2||keyvalue==3||keyvalue==4||keyvalue==5||keyvalue==6||key
             -value==7||keyvalue==8||keyvalue==9)
 265   6                        {
 266   7                          if(k==6)
 267   7                          {
 268   8                            value[0]=keyvalue;
 269   8                          }
 270   7                          else if(k==7)
 271   7                          {
 272   8                            value[1]=keyvalue;
 273   8                          }
 274   7                          else if(k==8)
 275   7                          {
 276   8                            value[2]=keyvalue;
 277   8                          }
 278   7                          keyvalue = '0'+ keyvalue;           
 279   7                          lcd1602_write_char(k,1,keyvalue);
 280   7                        }
 281   6                        else if(keyvalue == 11)
 282   6                        {
 283   7                          k=k-1;
 284   7                        }
 285   6                        else if(keyvalue == 12)
 286   6                        {
 287   7                          k=k+1;
 288   7                        }
 289   6                        else if (keyvalue==16)
 290   6                        {
 291   7                          dishu_sheding = value[0]*100+value[1]*10+value[2]; 
 292   7                          break;
 293   7                        }
 294   6                        else;
 295   6                        while (KeyPress());
 296   6                      }
 297   5                    }
 298   4                  }
 299   3                  while (KeyPress());
 300   3              }else{
C51 COMPILER V9.57.0.0   MAIN                                                              04/08/2019 18:40:39 PAGE 6   

 301   3                lcd1602_write_char(6,1,'0'+dishu_sheding/100);
 302   3                lcd1602_write_char(7,2,'0'+dishu_sheding%100/10);
 303   3                lcd1602_write_char(8,3,'0'+dishu_sheding%10);
 304   3              }
 305   2              
 306   2          DelayMs(200);
 307   2        }
 308   1      } 
 309          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1381    ----
   CONSTANT SIZE    =     19    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     41       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
